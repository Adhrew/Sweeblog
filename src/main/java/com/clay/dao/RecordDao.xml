<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.clay.dao.RecordDao">

	<resultMap type="com.clay.entity.Record" id="reco">
		<id property="record_id" column="record_id"/>
		<result property="record_status" column="record_status"/>
		<result property="record_ok" column="record_ok"/>
		<result property="record_starttime" column="record_starttime"/>
		<result property="record_endtime" column="record_endtime"/>
		<result property="record_money" column="record_money"/>
		<association property="blog_id" javaType="com.clay.entity.Blog" column="blog_id" select="com.clay.dao.BlogDao.queryById"/>
		<association property="user_id" javaType="com.clay.entity.User" column="user_id" select="com.clay.dao.UserDao.queryById"/>
	</resultMap>
	
	<select id="queryByPage" resultMap="reco">
		select * from record_info 
	</select>
	
	<select id="getCount" resultType="java.lang.Integer">
		select count(*) from record_info
	</select>
	
	<select id="queryById" resultMap="reco" parameterType="java.lang.Integer">
		select * from record_info where   record_id = #{id}
	</select>
	
	<select id="getCountByUserId" resultType="java.lang.Integer" parameterType="java.lang.Integer">
		select count(*) from record_info where user_id = #{id}
	</select>
	
	<select id="queryByPageAndUserId" resultMap="reco" parameterType="java.lang.Integer">
		select * from record_info where  user_id = #{id}
	</select>
	
	<select id="getCountByBlogId" resultType="java.lang.Integer" parameterType="java.lang.Integer">
		select count(*) from record_info where blog_id = #{id}
	</select>
	
	<select id="queryByPageAndBlogId" resultMap="reco" parameterType="java.lang.Integer">
		select * from record_info where  blog_id = #{id}
	</select>
	
	<select id="queryByPageAndBlogUserId" resultMap="reco" parameterType="java.lang.Integer">
		select * 
		from record_info i, blog_info b, user_info u 
		where b.user_id = u.user_id and b.blog_id = i.blog_id
		 		and u.user_id = #{id}
	</select>
	
	<select id="getCountByBlogUserId" resultType="java.lang.Integer" parameterType="java.lang.Integer">
		select count(*)
		from record_info i, blog_info b, user_info u 
		where b.user_id = u.user_id and b.blog_id = i.blog_id
		 		and u.user_id = #{id}
	</select>
	
	<insert id="insertRecord" parameterType="com.clay.entity.Record">
		insert into record_info(blog_id,user_id,record_status,record_ok,record_starttime,record_money)
		values(#{blog_id.blog_id},#{user_id.user_id},0,0,now(),#{record_money})
	</insert>
	
	<delete id="deleteRecord" parameterType="java.lang.Integer">
		delete from record_info where record_id = #{id};
	</delete>
	
	<update id="updateRecord" parameterType="com.clay.entity.Record">
		update record_info set
		<if test="record_status!=null">
			record_status=#{record_status},
		</if>
		<if test="record_ok!=null">
			record_ok=#{record_ok},
		</if>
		<if test="record_money!=null">
			record_money=#{record_money},
		</if>
		<if test="record_starttime!=null">
			record_starttime = now(),
		</if>
		<if test="record_endtime!=null">
			record_endtime = now(),
		</if>
			record_id = #{record_id} 
		<where>
			record_id = #{record_id}
		</where>
	</update>
	
</mapper>